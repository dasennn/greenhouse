# Ζεύγη Κουτελού - Τεκμηρίωση

## Περιγραφή

Τα **ζεύγη κουτελού** είναι δομικά στοιχεία που τοποθετούνται στις προσόψεις του θερμοκηπίου (βορράς και νότος).

## Λογική Εφαρμογής

### Που Τοποθετούνται
- **Μόνο** στις προσόψεις (βόρεια και νότια πλευρά)
- **ΟΧΙ** στις ανατολικές και δυτικές πλευρές

### Προϋποθέσεις
- Η προσόψη πρέπει να είναι **κανονική** (οριζόντια)
- Δεν εφαρμόζεται σε **παράγωνες** προσόψεις (διαγώνιες)

### Υπολογισμός Ποσότητας

**Σκοπός:** Τα ζεύγη κουτελού βοηθούν να κρατηθεί το νάιλον του θερμοκηπίου.

**Λογική:**
Σε κάθε **πυραμίδα** (τρίγωνο) στις προσόψεις μπαίνουν **2 ζεύγη πλευρών**:
1. **1 ζεύγος** από τον χαμηλό στύλο → στον ψηλό στύλο (κορυφή πυραμίδας)
2. **1 ζεύγος** από τον κορφιάτη → στην υδρορροή

**Τύπος:**
- **Σύνολο ζευγών = (αριθμός_πυραμίδων_βορρά + αριθμός_πυραμίδων_νότου) × 2**
- Αριθμός πυραμίδων = πλάτος προσόψης ÷ 5m (ένα κελί πλάτους)

**Σημείωση:** Το μήκος της σωλήνας (π.χ. 2.54m) που ανεβαίνει από την υδρορροή στον κορφιάτη είναι ρυθμιζόμενο αλλά **ΔΕΝ επηρεάζει** τον υπολογισμό της ποσότητας. Η ποσότητα μετριέται σε **ζεύγη** (pairs), όχι σε μέτρα.

### Πλευρά (Κανονικά)

Τα **πλευρά** είναι ίδιας φιλοσοφίας με τα ζεύγη κουτελού:
- **Ίδιο μήκος** με τα ζεύγη κουτελού (π.χ. 2.54m)
- **ΔΕΝ** μπαίνουν στις προσόψεις (βορράς/νότος)
- Μπαίνουν **κατά μήκος του βάθους** (άξονας Υ)
- **ΟΧΙ ζεύγη** - είναι μονά τεμάχια
- Πρώτο πλευρό: 0.5m από την προσόψη
- Μετά: ανά 1m απόσταση

**Τύπος:**
- Χρήσιμο βάθος = βάθος - 2 × 0.5m
- Πλευρά = floor(χρήσιμο_βάθος ÷ 1m) + 1

## Τεχνική Υλοποίηση

### Αρχεία που Τροποποιήθηκαν

1. **`services/default_materials.py`**
   - Προστέθηκε το υλικό `koutelou_pair` με κωδικό, όνομα, μονάδα (m) και τιμή

2. **`services/geometry/koutelou_estimation.py`** (ΝΕΟ)
   - Συνάρτηση `estimate_koutelou_pairs()` που:
     - Εντοπίζει τις προσόψεις (βορράς/νότος) με χρήση του `find_north_south_chains`
     - Ελέγχει αν οι προσόψεις είναι κανονικές (όχι παράγωνες)
     - Υπολογίζει τον αριθμό των κελιών σε κάθε προσόψη
     - Επιστρέφει το συνολικό μήκος σε μέτρα

3. **`services/material_estimator.py`**
   - Ενημερώθηκε η `estimate_material_quantities()` να δέχεται `koutelou_est`
   - Προσθέτει το `koutelou_pair` στις ποσότητες υλικών

4. **`services/estimator.py`**
   - Ενημερώθηκε η `compute_bom()` να δέχεται `koutelou_est`

5. **`services/geometry/__init__.py`** και **`services/geometry_utils.py`**
   - Export της νέας συνάρτησης `estimate_koutelou_pairs`

6. **`ui/main_window.py`**
   - Import της `estimate_koutelou_pairs`
   - Κλήση της συνάρτησης σε δύο σημεία για υπολογισμό BOM
   - Πέρασμα του αποτελέσματος στο `compute_bom()`

## Παράμετροι Ρύθμισης

Η συνάρτηση `estimate_koutelou_pairs()` δέχεται:
- `grid_w_m`: Πλάτος κελιού (default: 5.0m)
- `grid_h_m`: Ύψος κελιού (default: 3.0m)
- `scale_factor`: Συντελεστής μετατροπής pixels σε μέτρα
- `pipe_length_m`: Μήκος σωλήνας από υδρορροή σε κορφιάτη (default: 2.54m, ρυθμιζόμενο από χρήστη)

## Παράδειγμα Χρήσης

```python
from services.geometry import estimate_koutelou_pairs

# Υπολογισμός ζευγών κουτελού για πολύγωνο
result = estimate_koutelou_pairs(
    points=polygon_points,
    grid_w_m=5.0,
    grid_h_m=3.0,
    scale_factor=5.0,
    pipe_length_m=2.54  # Ρυθμιζόμενο μήκος σωλήνας
)

if result and result.get('is_regular'):
    total_pairs = result['total_pairs']
    total_pyramids = result['total_pyramids']
    print(f"Πυραμίδες: {total_pyramids}")
    print(f"Συνολικά ζεύγη: {total_pairs} (={total_pyramids} × 2)")
else:
    print("Οι προσόψεις δεν είναι κανονικές")
```

## Επιστρεφόμενα Δεδομένα

Η συνάρτηση επιστρέφει dictionary με:
- `total_pairs`: Συνολικός αριθμός ζευγών (integer)
- `north_pyramids`: Αριθμός πυραμίδων στο βορρά
- `south_pyramids`: Αριθμός πυραμίδων στο νότο
- `total_pyramids`: Συνολικός αριθμός πυραμίδων
- `is_regular`: Αν οι προσόψεις είναι κανονικές
- `pipe_length_m`: Μήκος σωλήνας (για αναφορά)
- `notes`: Σημειώσεις

## Τιμολόγηση

Το υλικό προστέθηκε στο κατάλογο με:
- **Κωδικός**: `koutelou_pair`
- **Όνομα**: "Ζεύγη Κουτελού"
- **Μονάδα**: ζεύγος (piece) - κάθε ζεύγος = 2 τεμάχια
- **Τιμή**: 8.50 EUR/ζεύγος (ρυθμιζόμενη)

Το σύνολο υπολογίζεται αυτόματα στο BOM ως: `total_pairs × unit_price`

**Παράδειγμα:** 
- Αν έχουμε 10 πυραμίδες στο βορρά + 10 στο νότο = 20 πυραμίδες
- Ζεύγη = 20 × 2 = **40 ζεύγη**
- Κόστος = 40 × 8.50 = **340 EUR**
